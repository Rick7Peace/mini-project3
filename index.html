<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta
      name="description"
      content="FallingBlocks+ - A free, open-source falling block puzzle game with bilingual support, custom themes, and accessibility features."
    />
    <meta
      name="keywords"
      content="puzzle game, falling blocks, block game, free game, open source"
    />
    <meta name="author" content="Ricardo Marmolejo" />

    <!-- Security Headers (will be set via netlify.toml instead) -->
    <!-- Removed: X-Frame-Options meta tag (doesn't work in meta) -->

    <!-- PWA Support -->
    <meta name="theme-color" content="#1a1a2e" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <!-- âœ… Added modern standard -->

    <title>Falling Blocks + v11.1</title>
    <link rel="stylesheet" href="./assets/style.css" />
  </head>

  <body class="dark">
    <!-- HEADER -->
    <header>
      <h1>Falling Blocks +</h1>

      <div class="header-buttons">
        <button id="theme-toggle">
          <span class="lang-en">ğŸŒ™ MoonLight</span>
          <span class="lang-es" hidden>ğŸŒ™ Luna</span>
        </button>
        <button id="info-btn" class="info-btn">
          <span class="lang-en">â„¹ï¸ Instructions</span>
          <span class="lang-es" hidden>â„¹ï¸ Instrucciones</span>
        </button>
        <button id="lang-toggle" class="lang-toggle">ğŸŒ Spanish</button>
      </div>
    </header>

    <!-- MAIN GAME AREA -->
    <div class="game-container">
      <!-- LEFT PANEL: Controls -->
      <aside class="controls-panel">
        <label for="difficulty">
          <span class="lang-en">Difficulty:</span>
          <span class="lang-es" hidden>Dificultad:</span>
        </label>
        <select id="difficulty">
          <option value="1" data-en="1 â€“ Easy" data-es="1 â€“ FÃ¡cil">
            1 â€“ Easy
          </option>
          <option value="2" data-en="2 â€“ Medium" data-es="2 â€“ Medio">
            2 â€“ Medium
          </option>
          <option value="3" data-en="3 â€“ Hard" data-es="3 â€“ DifÃ­cil">
            3 â€“ Hard
          </option>
        </select>

        <div class="buttons">
          <button id="start-button">
            <span class="lang-en">â–¶ï¸ Start</span>
            <span class="lang-es" hidden>â–¶ï¸ Empezar</span>
          </button>
          <button id="pause-button">
            <span class="lang-en">â¸ï¸ Pause</span>
            <span class="lang-es" hidden>â¸ï¸ Pausar</span>
          </button>
          <button id="quit-button">
            <span class="lang-en">âŒ Quit</span>
            <span class="lang-es" hidden>âŒ Salir</span>
          </button>
          <button id="reset-scores">
            <span class="lang-en">ğŸ” Reset Scores</span>
            <span class="lang-es" hidden>ğŸ” Reiniciar Puntuaciones</span>
          </button>
        </div>

        <button id="music-button">
          <span class="lang-en">ğŸµ Play Music</span>
          <span class="lang-es" hidden>ğŸµ Reproducir MÃºsica</span>
        </button>

        <button id="feedback-button" class="feedback-btn">
          <span class="lang-en">ğŸ’¬ Feedback</span>
          <span class="lang-es" hidden>ğŸ’¬ Comentarios</span>
        </button>

        <!-- AUDIO ASSETS -->
        <audio id="bg-music" loop preload="auto">
          <source
            src="./assets/music/SLOWEST-TEMPO2019-12-11_-_Retro_Platforming_-_David_Fesliyan.mp3"
            type="audio/mpeg"
          />
        </audio>
        <audio id="level-up-sound">
          <source
            src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3"
            type="audio/mpeg"
          />
        </audio>
        <audio id="land-sound">
          <source
            src="https://assets.mixkit.co/active_storage/sfx/2001/2001-preview.mp3"
            type="audio/mpeg"
          />
        </audio>
        <audio id="clear-sound">
          <source
            src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"
            type="audio/mpeg"
          />
        </audio>
        <audio id="pulse-sound">
          <source
            src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"
            type="audio/mpeg"
          />
        </audio>
      </aside>

      <!-- CENTER: Game Grid -->
      <div class="grid-wrapper">
        <div id="grid" tabindex="0"></div>

        <div id="mobile-controls">
          <button id="left-btn" aria-label="Move left">â¬…ï¸</button>
          <button id="rotate-btn" aria-label="Rotate piece">ğŸ”„</button>
          <button id="right-btn" aria-label="Move right">â¡ï¸</button>
          <button id="down-btn" aria-label="Move down">â¬‡ï¸</button>
        </div>
      </div>

      <!-- RIGHT PANEL: Stats -->
      <aside class="info">
        <!-- 1. Player Badge -->
        <p id="player-badge">
          <span class="lang-en">ğŸ‘¤ Player: â€”</span>
          <span class="lang-es" hidden>ğŸ‘¤ Jugador: â€”</span>
        </p>

        <!-- 2. Next Piece Preview -->
        <div id="next-wrapper">
          <h4>
            <span class="lang-en">Next</span>
            <span class="lang-es" hidden>Siguiente</span>
          </h4>
          <div id="next-grid"></div>
        </div>

        <!-- 3. Score -->
        <h2>
          <span class="lang-en">Score: <span id="score">0</span></span>
          <span class="lang-es" hidden
            >PuntuaciÃ³n: <span id="score-es">0</span></span
          >
        </h2>

        <!-- 4. Level -->
        <h3>
          <span class="lang-en">Level: <span id="level">1</span></span>
          <span class="lang-es" hidden
            >Nivel: <span id="level-es">1</span></span
          >
        </h3>

        <!-- 5. High Score -->
        <h3>
          <span class="lang-en"
            >ğŸ† High Score: <span id="high-score">0</span></span
          >
          <span class="lang-es" hidden
            >ğŸ† PuntuaciÃ³n MÃ¡xima: <span id="high-score-es">0</span></span
          >
        </h3>

        <!-- 6. Leaderboard -->
        <div id="leaderboard">
          <h4>
            <span class="lang-en">Top 10 Players</span>
            <span class="lang-es" hidden>Top 10 Jugadores</span>
          </h4>
          <ol id="leaderboard-list"></ol>
        </div>
      </aside>
    </div>
    <!-- FOOTER -->
    <footer>
      <div class="footer-main">
        <span class="lang-en">Built with â¤ï¸ </span>
        <span class="lang-es" hidden>Hecho con â¤ï¸</span>
      </div>
    </footer>

    <!-- INSTRUCTIONS MODAL -->
    <div
      id="info-modal"
      class="info-modal"
      role="dialog"
      aria-labelledby="info-modal-title"
      aria-modal="true"
    >
      <div class="info-modal-content">
        <!-- ENGLISH VERSION -->
        <div id="instructions-en" class="instructions-content">
          <h2 id="info-modal-title">How to Play FallingBlocks+</h2>

          <h3>Goal of the Game</h3>
          <p>
            Place the falling shapes to complete horizontal lines. Full lines
            disappear and give you points. If the stack reaches the top of the
            grid, the game ends.
          </p>

          <h3>âŒ¨ï¸ Controls</h3>
          <ul>
            <li>â¬…ï¸ Left Arrow â€” Move left</li>
            <li>â¡ï¸ Right Arrow â€” Move right</li>
            <li>â¬†ï¸ Up Arrow â€” Rotate</li>
            <li>â¬‡ï¸ Down Arrow â€” Soft drop (faster fall)</li>
            <li>SPACE â€” Hard drop (instantly place piece)</li>
            <li>P â€” Pause / Resume</li>
          </ul>

          <h3>ğŸ“± Mobile Controls</h3>
          <ul>
            <li>Swipe Left â€” Move left</li>
            <li>Swipe Right â€” Move right</li>
            <li>Swipe Up â€” Rotate</li>
            <li>Swipe Down â€” Soft drop</li>
            <li>Tap â€” Hard drop</li>
          </ul>
          <p>
            <strong
              >For best mobile experience: Rotate your phone/tablet
              sideways!</strong
            >
          </p>

          <h3>ğŸ“ˆ Levels, Scoring & Speed</h3>
          <ul>
            <li>Clear lines to earn points.</li>
            <li>More lines at the same time = more points.</li>
            <li>Every 500 hundred points, you level up.</li>
            <li>Higher levels make the pieces fall faster.</li>
          </ul>

          <h3>ğŸ’¡ Tips</h3>
          <ul>
            <li>Keep your stack low.</li>
            <li>Use hard drop to place pieces quickly.</li>
            <li>Watch the "Next Piece" preview to plan ahead.</li>
          </ul>

          <h3>âš™ï¸ Difficulty</h3>
          <p>
            Easy = Slow â€¢ Medium = Normal â€¢ Hard = Fast Choose before starting
            the game.
          </p>

          <p><strong>Ready? Press â–¶ï¸ Start!</strong></p>
        </div>

        <!-- SPANISH VERSION -->
        <div id="instructions-es" class="instructions-content" hidden>
          <h2>CÃ³mo Jugar</h2>

          <h3>Objetivo del Juego</h3>
          <p>
            Coloca las piezas que caen para formar lÃ­neas completas. Las lÃ­neas
            completas desaparecen y dan puntos. Si la pila llega hasta arriba,
            el juego termina.
          </p>

          <h3>âŒ¨ï¸ Controles</h3>
          <ul>
            <li>â¬…ï¸ Izquierda â€” Mover</li>
            <li>â¡ï¸ Derecha â€” Mover</li>
            <li>â¬†ï¸ Arriba â€” Rotar</li>
            <li>â¬‡ï¸ Abajo â€” CaÃ­da rÃ¡pida</li>
            <li>ESPACIO â€” CaÃ­da instantÃ¡nea</li>
            <li>P â€” Pausar / Reanudar</li>
          </ul>

          <h3>ğŸ“± Controles MÃ³viles</h3>
          <ul>
            <li>Deslizar Izquierda â€” Mover</li>
            <li>Deslizar Derecha â€” Mover</li>
            <li>Deslizar Arriba â€” Rotar</li>
            <li>Deslizar Abajo â€” CaÃ­da rÃ¡pida</li>
            <li>Toque â€” CaÃ­da instantÃ¡nea</li>
          </ul>
          <p>
            <strong
              >Para la mejor experiencia mÃ³vil: Â¡Gira tu telÃ©fono/tableta de
              lado!</strong
            >
          </p>

          <h3>ğŸ“ˆ Niveles, Puntos y Velocidad</h3>
          <ul>
            <li>Completar lÃ­neas te da puntos.</li>
            <li>MÃ¡s lÃ­neas a la vez = mÃ¡s puntos.</li>
            <li>Cada 500 puntos subes de nivel.</li>
            <li>Los niveles altos hacen que las piezas caigan mÃ¡s rÃ¡pido.</li>
          </ul>

          <h3>ğŸ’¡ Consejos</h3>
          <ul>
            <li>MantÃ©n la pila baja.</li>
            <li>Usa la caÃ­da instantÃ¡nea para jugar mÃ¡s rÃ¡pido.</li>
            <li>Mira la vista previa "Siguiente Pieza".</li>
          </ul>

          <h3>âš™ï¸ Dificultad</h3>
          <p>
            FÃ¡cil = Lento â€¢ Medio = Normal â€¢ DifÃ­cil = RÃ¡pido Elige la
            dificultad antes de comenzar.
          </p>

          <p><strong>Â¡Listo? Â¡Presiona â–¶ï¸ Empezar!</strong></p>
        </div>

        <button id="close-info" class="close-info">
          <span class="lang-en">Close</span>
          <span class="lang-es" hidden>Cerrar</span>
        </button>
      </div>
    </div>
    <!-- FEEDBACK MODAL -->
    <div
      id="feedback-modal"
      class="info-modal"
      role="dialog"
      aria-labelledby="feedback-modal-title"
      aria-modal="true"
    >
      <div class="info-modal-content feedback-content">
        <h2 id="feedback-modal-title">
          <span class="lang-en">ğŸ’¬ Send Feedback</span>
          <span class="lang-es" hidden>ğŸ’¬ Enviar Comentarios</span>
        </h2>

        <p class="feedback-intro">
          <span class="lang-en"
            >Share your feedback, bug reports, or suggestions:</span
          >
          <span class="lang-es" hidden
            >Comparte tus comentarios, reportes de errores o sugerencias:</span
          >
        </p>

        <div id="feedback-form-container">
          <!-- Honeypot field for spam protection -->
          <input
            type="text"
            name="_gotcha"
            style="display: none"
            tabindex="-1"
            autocomplete="off"
          />

          <div class="form-group">
            <label for="feedback-name">
              <span class="lang-en">Your Name (Optional)</span>
              <span class="lang-es" hidden>Tu Nombre (Opcional)</span>
            </label>
            <input
              type="text"
              id="feedback-name"
              class="feedback-input"
              maxlength="50"
              placeholder="John Doe"
              autocomplete="name"
            />
          </div>

          <div class="form-group">
            <label for="feedback-email-input">
              <span class="lang-en">Your Email (Optional - for replies)</span>
              <span class="lang-es" hidden
                >Tu Correo (Opcional - para respuestas)</span
              >
            </label>
            <input
              type="email"
              id="feedback-email-input"
              class="feedback-input"
              placeholder="you@example.com"
              autocomplete="email"
            />
          </div>

          <div class="form-group">
            <label for="feedback-message">
              <span class="lang-en">Your Message *</span>
              <span class="lang-es" hidden>Tu Mensaje *</span>
            </label>
            <textarea
              id="feedback-message"
              class="feedback-textarea"
              rows="6"
              maxlength="1000"
              required
              aria-required="true"
            ></textarea>
            <div class="char-counter">
              <span id="char-count">0</span> / 1000
            </div>
          </div>

          <button id="submit-feedback" class="submit-feedback-btn">
            <span class="lang-en">ğŸ“¤ Send Feedback</span>
            <span class="lang-es" hidden>ğŸ“¤ Enviar Comentarios</span>
          </button>

          <div
            id="feedback-status"
            class="feedback-status"
            style="display: none"
            role="alert"
            aria-live="polite"
          ></div>
        </div>

        <button id="close-feedback" class="close-info">
          <span class="lang-en">Close</span>
          <span class="lang-es" hidden>Cerrar</span>
        </button>
      </div>
    </div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCSt7AkEMW8ph5zlNtD35RShfLCnvZKETA",
    authDomain: "falling-blocks-plus.firebaseapp.com",
    projectId: "falling-blocks-plus",
    storageBucket: "falling-blocks-plus.firebasestorage.app",
    messagingSenderId: "260793370262",
    appId: "1:260793370262:web:914459bc7e4f23ec3ce4b7"
  };
  
  // Initialize Firebase
  try {
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.firestore();
    console.log('âœ… Firebase initialized successfully');
  } catch (error) {
    console.error('âŒ Firebase initialization failed:', error);
    window.db = null;
  }
</script>

<script src="./assets/script.js"></script>
<div id="rotation-reminder">ğŸ”„ Rotate for best experience</div>
</body>
</html>